{% extends 'base.html.twig' %}

{% block title %}
	{{trick.name}}
{% endblock %}

{% block body %}
	<div class="row justify-content-center ">
		<div class="card mt-1 ">
			<div class=" position-relative">
				<img class=" card-img-top img-fluid w-100 " src="/uploads/{{ mainPicture }}" alt="{{trick.name}} picture ">
				<h1 class="position-absolute top-50 start-50 translate-middle bg-primary text-dark  bg-gradient rounded opacity-75 p-2 shadow-lg text-center border border-secondary ">{{ trick.name }}</h1>
				<h1 class="position-absolute top-50 start-50 translate-middle  text-secondary rounded  p-2 shadow-lg text-center  ">{{ trick.name }}</h1>
				{% if app.user == trick.user %}
					<div class="position-absolute top-0 end-0 mt-1 mx-1">
						<a href="{{ path('app_trick_delete', {'slug' : trick.slug }) }}" class="btn btn-danger ">
							<i class="fa-regular fa-trash-can"></i>
						</a>
						<a href="{{ path('app_trick_edit', {'slug' : trick.slug }) }}" class="btn btn-info">
							<i class="fa-regular fa-pen-to-square"></i>
						</a>
					</div>
				{% endif %}
			</div>
			<div class="card-body">
				<ul class="list-inline d-flex justify-content-around align-items-center">
					<li class="list-inline-item">
						<i class="fa-regular fa-user"></i>
						{{ trick.user.username }}

					</li>
					<li class="list-inline-item">
						<small class="text-dark bg-secondary rounded px-1" title="Création">
						<i class="fa-regular fa-calendar-plus"></i>
						{{ trick.createdAt | date('d/m/Y') }}
						</small>
						<small class="text-secondary bg-primary rounded px-1 d-inline-block" title="Dernière Mis à jour">
							<i class="fa-solid fa-file-pen"></i>
							{% if trick.updatedAt %}
								{{ trick.updatedAt | date('d/m/Y') }}
							{% endif %}
						</small>
					</li>
					<li class="list-inline-item">
						<i class="fa-solid fa-person-snowboarding"></i>
						{{ trick.category.name }}
					</li>
					<li class="list-inline-item">
						<a href="#comments" class="btn btn-info">
							<i class="fa-regular fa-comments"></i>
							{{ trick.comments | length }}</a>
					</li>
				</ul>
				<hr>
				<h4 class="card-title">
					<strong>{{ trick.name }}</strong>
				</h4>
				<hr>
				<section>
					<div
						class="container col-8 d-flex justify-content-around flex-wrap">
						{# carrousel bootstrap #}
						<div id="carousel" class="carousel slide carousel-fade" data-bs-ride="carousel">
							<div class="carousel-indicators">
								{%  set isFirst = true %}
								{% for media in medias %}
									{% if isFirst == true %}
										<button type="button" data-bs-target="#carousel" data-bs-slide-to="{{ loop.index0 }}" class="active"></button>
									{% else %}
										<button type="button" data-bs-target="#carousel" data-bs-slide-to="{{ loop.index0 }}"></button>
									{% endif %}

									{% set isFirst = false %}
								{% endfor %}
							</div>
							<div class="carousel-inner" role="listbox">
								{%  set isFirst = true %}
								{% for media in medias %}
									{% if isFirst == true %}
										<div class="carousel-item active">
										{% else %}
											<div class="carousel-item">
											{% endif %}
											<img src="/uploads/{{ media.path }}" class="d-block w-100" alt="">
										</div>
										{% set isFirst = false %}
									{% endfor %}
								</div>


								<button class="carousel-control-prev" type="button" data-bs-target="#carousel" data-bs-slide="prev">
									<span class="carousel-control-prev-icon" aria-hidden="true"></span>
									<span class="visually-hidden">Previous</span>
								</button>
								<button class="carousel-control-next" type="button" data-bs-target="#carousel" data-bs-slide="next">
									<span class="carousel-control-next-icon" aria-hidden="true"></span>
									<span class="visually-hidden">Next</span>
								</button>
							</div>
						</div>
					</section>
					<hr>
					<h4 class="card-title text-center">Description</h4>
					<hr>
					<p class="container col-10 card-text text-justify">{{ trick.description }}</p>
					<hr>

				</div>
			</div>

			<div class="card border-primary mt-3 text-center">
				<div class="card-header text-left ">
					<h4>Commentaires</h4>
				</div>
				<div class="card-body text-center">
					{% if app.user and app.user.active %}
						{{ form_start(formComment) }}
						{{ form_row(formComment.content, {
                				'label' : 'Ajouter une commentaire',
                				'attr'  : {'placeholder' : 'Entrer votre commentaire'},
        						} 
        					) }}
						{{ form_end(formComment)}}
					{% else %}
						<div class="text-center my-3 p-3">
							<h6>Merci de vous connecter pour laisser un commentaire.</h6>
							<a href="{{ path('app_security_login') }}" class="btn btn-primary">Connexion</a>
						</div>
					{% endif %}
				</div>
			</div>
			<section id="comments" class="d-block mt-3">
				<div class=" d-flex col-12 pl-0 pr-0 justify-content-center">
					<div class="card rounded shadow-lg text-left p-5 mb-5 ">
						<div class="entry-comments">
							<h6 class="mb-5">{{ trick.comments | length }}
								Commentaires</h6>
							<ul class="entry-comments-list list-unstyled">
								{% for comment in comments %}
									<li>
										<div class="d-flex mt-3 pb-2  border-bottom ">
											<img src="/uploads/{{ comment.user.avatar }}" class=" rounded" style="witdh: 60px; height: 60px;" alt="{{ comment.user.username }}">
											<div class="ml-4">
												<span class="display-6">
													{{ comment.user.username }}
												</span>
												<span class="text-muted">Le
													{{ comment.createdAt | date("d/m/Y à h:i")}}
												</span>
												<p class="mt-2">{{ comment.content }}</p>
											</div>
										</div>
									</li>
								{% endfor %}
							</ul>
						</div>
					</div>
				</div>
			</section>
		{% endblock %}
