{% extends 'base.html.twig' %}


{% block title %}Trick
{% endblock %}


{% block body %}
	<h1>
		{% if trick.id %}
			Modifier la Figure
		{% else %}
			Ajouter un Trick
		{% endif %}
	</h1>
	{{ form_start(formTrick) }}

	{{ form_row(formTrick.name, {
                'label' : 'Nom de la figure',
                'attr'  : {'placeholder' : 'Entrer la nouvelle figure'},
        } 
        ) }}

	{{ form_row(formTrick.description, {
                'label' : 'Description',
                'attr'  : {'placeholder' : 'Entrer la description de la figure'},
        } 
        ) }}

	{{ form_row(formTrick.category, {
                'label' : 'Categorie',
                'attr'  : {'placeholder' : 'Selectionner la catégorie'},
        } 
        ) }}

	{{ form_widget(formTrick._token) }}
	{{ form_errors(formTrick) }}
	<div class="d-grid col-6 mx-auto mb-2">
		<button type="button" class="btn btn-outline-secondary btn-new" data-collection-holder-class="medias">Ajouter un nouveau media</button>
	</div>
	<ul id="medias" class="gap-2 col-12 medias d-flex p-2 justify-content-around flex-wrap" data-prototype="{{ form_widget(formTrick.medias.vars.prototype)|e("html_attr") }}" data-index="{{ formTrick.medias|length > 0 ? formTrick.medias|last.vars.name + 1 : 0 }}">
		{% for media in formTrick.medias %}
			<dd class="col-lg-4 col-sm-10" name="typeMedia">
				{{ form_row(media.typeMedia) }}
			</dd>
			<dd class="col-lg-4 col-sm-10">
				{{ form_row(media.path) }}
			</dd>
			
		{% endfor %}
	</ul>
	
	{{ form_errors(formTrick.medias) }}

	<div class="d-grid gap-2 col-10 mx-auto">
		<button class="btn btn-primary ">
			{% if trick.id %}
				Modifier votre Trick
			{% else %}
				Créer votre Trick
			{% endif %}
		</button>
	</div>
	{{ form_end(formTrick, {render_rest: false}) }}
{% endblock %}

{% block javascripts %}
	<script>
		window.addEventListener('load', () => {
			
			function getId(){   
    			const listtypemedias = document.getElementsByTagName("typeMediaClass");
				const buttonPressed = e => {
					return e.target.id
				// console.log(e.target.id);  // Get ID of Clicked Element
				}
				for (let listtypemedia of listtypemedias) {
				listtypemedia.addEventListener("click", buttonPressed);
				}
			}
			
			let typeMedia = document.querySelector("#"+getId());
				
			if (typeMedia != null) {
    
  
				typeMedia.addEventListener("click",function(){

					let form = this.closest("form");
					let data = this.name + "=" + this.value;

					fetch(form.action, {
						method: form.getAttribute("method"),
						body : data,
						header: {
							"Content-Type": "application/x-www-form-urlencoded; charset:utf-8"
						}
					})
				// 	.then(response => response.text())
				// 	.then(html =>{
				// 		let content = document.createElement("html");
				// 		content.innerHTML =html;
				// 		let ne
					})
			 }





















			const addFormToCollection = (e) => {
				const collectionHolder = document.querySelector('.' + e.currentTarget.dataset.collectionHolderClass);

				const item = document.createElement('dd');
				item.classList.add("col-lg-4");
				item.classList.add("col-sm-10");
				item.classList.add("typemedia");
				item.innerHTML = collectionHolder.dataset.prototype.replace(/__name__/g, collectionHolder.dataset.index);

				collectionHolder.appendChild(item);
			collectionHolder.dataset.index ++;
			addMediaFormDeleteLink(item);
			}

			const addMediaFormDeleteLink = (item) => {
				let removeFormButton = document.createElement('button');
				removeFormButton.type = 'button';
				removeFormButton.className = 'btn btn-danger mb-2';
				removeFormButton.innerText = 'Supprimer';

				item.append(removeFormButton);

				removeFormButton.addEventListener('click', (e) => {
				e.preventDefault();
				// remove the li for the tag form
				item.remove();
				});
			}

			document.querySelectorAll('ul.medias dd').forEach((media) => {
			addMediaFormDeleteLink(media)
			});

			document.querySelectorAll('.btn-new').forEach(btn => {
			btn.addEventListener("click", addFormToCollection)
			});
		})
	</script>

{% endblock %}
